{
    "swagger": "2.0",
    "info": {
        "description": "",
        "version": "1.0.0",
        "title": "RebornDB API",
        "contact": {
            "email": "support@pingcap.com"
        },
        "license": {
            "name": "MIT",
            "url": "https://opensource.org/licenses/MIT"
        }
    },
    "schemes": [
        "http",
        "https"
    ],
    "produces": [
        "application/json"
    ],
    "paths": {
        "/api/server_groups": {
            "get": {
                "description": "Get server groups information.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An array of ServerGroup.",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/ServerGroup"
                            }
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            },
            "put": {
                "description": "Create new server group.",
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Server group information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/ServerGroup"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/overview": {
            "get": {
                "description": "Get overview infomation.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of Overview.",
                        "schema": {
                            "$ref": "#/definitions/Overview"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/redis/{redis_addr}/stat": {
            "get": {
                "description": "Get store information.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "redis_addr",
                        "description": "redis addr.",
                        "required": true,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of RedisInfo.",
                        "schema": {
                            "$ref": "#/definitions/RedisInfo"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/redis/{redis_addr}/{slot_id}/slotinfo": {
            "get": {
                "description": "Get slot keys information.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "redis_addr",
                        "description": "redis addr.",
                        "required": true,
                        "type": "string"
                    },
                    {
                        "in": "path",
                        "name": "slot_id",
                        "description": "ID of slot.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of SlotKeysInfo.",
                        "schema": {
                            "$ref": "#/definitions/SlotKeysInfo"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/redis/group/{group_id}/{slot_id}/slotinfo": {
            "get": {
                "description": "Get slot keys infomation in group.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "group_id",
                        "description": "ID of group.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    },
                    {
                        "in": "path",
                        "name": "slot_id",
                        "description": "ID of slot.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of GroupSlotKeysInfo.",
                        "schema": {
                            "$ref": "#/definitions/GroupSlotKeysInfo"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/server_group/{group_id}/addServer": {
            "put": {
                "description": "Add server to group.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "group_id",
                        "description": "ID of group.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    },
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Server information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/Server"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/server_group/{group_id}": {
            "get": {
                "description": "Get server group information.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "group_id",
                        "description": "ID of group.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of ServerGroup.",
                        "schema": {
                            "$ref": "#/definitions/ServerGroup"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            },
            "delete": {
                "description": "Delete group.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "group_id",
                        "description": "ID of group.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/server_group/{group_id}/removeServer": {
            "put": {
                "description": "Remove server from group.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "group_id",
                        "description": "ID of group.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    },
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Server information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/Server"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/server_group/{group_id}/promote": {
            "post": {
                "description": "Promote server in group to master.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "group_id",
                        "description": "ID of group.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    },
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Server information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/Server"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/migrate/status": {
            "get": {
                "description": "Get migrate status.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of MigrateStatus.",
                        "schema": {
                            "$ref": "#/definitions/MigrateStatus"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/migrate/tasks": {
            "get": {
                "description": "Get migrate tasks information.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An array of MigrateTaskInfo.",
                        "schema": {
                            "$ref": "#/definitions/MigrateTaskInfo"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/migrate/pending_task/{task_id}/remove": {
            "delete": {
                "description": "Remove migrate pending task.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "task_id",
                        "description": "ID of migrate task.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/migrate/task/{task_id}/stop": {
            "delete": {
                "description": "Stop migrate task.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "task_id",
                        "description": "ID of migrate task.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/migrate": {
            "post": {
                "description": "Create new migrate task.",
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Migrate task information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/MigrateTaskInfo"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/rebalance": {
            "post": {
                "description": "Server group keys rebalance.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/rebalance/status": {
            "get": {
                "description": "Status of server group keys rebalance.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of RebalanceStatus.",
                        "schema": {
                            "$ref": "#/definitions/RebalanceStatus"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/slot/list": {
            "get": {
                "description": "Slots information.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An array of Slot.",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/Slot"
                            }
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/slot/{slot_id}": {
            "get": {
                "description": "Slot information.",
                "parameters": [
                    {
                        "in": "path",
                        "name": "slot_id",
                        "description": "ID of slot.",
                        "required": true,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Slot.",
                        "schema": {
                            "$ref": "#/definitions/Slot"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/slot/init": {
            "post": {
                "description": "Init slot.",
                "parameters": [
                    {
                        "in": "formData",
                        "name": "is_force",
                        "description": "Force to init slot.",
                        "required": false,
                        "type": "string"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/slots": {
            "get": {
                "description": "Slots information.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An array of Slot.",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/Slot"
                            }
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/slot": {
            "post": {
                "description": "Set slot range information.",
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Range set task information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/RangeSetTask"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/proxy/list": {
            "get": {
                "description": "Proxies information.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An array of ProxyInfo.",
                        "schema": {
                            "type": "array",
                            "items": {
                                "$ref": "#/definitions/ProxyInfo"
                            }
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/proxy/debug/vars": {
            "get": {
                "description": "Proxy debug information.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of DebugVars.",
                        "schema": {
                            "$ref": "#/definitions/DebugVars"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/proxy": {
            "post": {
                "description": "Set proxy status information.",
                "parameters": [
                    {
                        "in": "body",
                        "name": "body",
                        "description": "Proxy information.",
                        "required": true,
                        "schema": {
                            "$ref": "#/definitions/ProxyInfo"
                        }
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/action/gc": {
            "get": {
                "description": "Clean up actions infomation.",
                "parameters": [
                    {
                        "in": "formData",
                        "name": "keep",
                        "description": "Actions number to keep.",
                        "required": false,
                        "type": "integer",
                        "format": "int64"
                    },
                    {
                        "in": "formData",
                        "name": "secs",
                        "description": "Actions in lastest seconds to keep.",
                        "required": false,
                        "type": "integer",
                        "format": "int64"
                    }
                ],
                "responses": {
                    "200": {
                        "description": "An object of DebugVars.",
                        "schema": {
                            "$ref": "#/definitions/DebugVars"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/force_remove_locks": {
            "get": {
                "description": "Force to remove locks.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/api/remove_fence": {
            "get": {
                "description": "Remove fence.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "An object of Result.",
                        "schema": {
                            "$ref": "#/definitions/Result"
                        }
                    },
                    "500": {
                        "description": "Unexpected error"
                    }
                }
            }
        },
        "/ping": {
            "get": {
                "description": "Ping.",
                "parameters": [],
                "responses": {
                    "200": {
                        "description": "Success."
                    }
                }
            }
        }
    },
    "definitions": {
        "DebugVars": {
            "type": "object",
            "properties": {}
        },
        "GroupSlotKeysInfo": {
            "type": "object",
            "properties": {
                "addr": {
                    "type": "string",
                    "description": "Addr of server."
                },
                "group_id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of server group."
                },
                "key": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Keys count in slot."
                },
                "slot_id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of slot."
                }
            }
        },
        "MigrateStatus": {
            "type": "object",
            "properties": {
                "migrate_slots": {
                    "type": "array",
                    "description": "Migrate slots information.",
                    "items": {
                        "$ref": "#/definitions/Slot"
                    }
                },
                "migrate_task": {
                    "type": "object",
                    "description": "Migrate task information.",
                    "$ref": "#/definitions/MigrateTaskInfo"
                }
            }
        },
        "MigrateTaskInfo": {
            "type": "object",
            "properties": {
                "from": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of migarate from slot."
                },
                "to": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of migarate to slot."
                },
                "new_group": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of new group."
                },
                "delay": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Millisecond of delay to run task in future."
                },
                "create_at": {
                    "type": "string",
                    "description": "Create time of task."
                },
                "percent": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Percent of task completion."
                },
                "status": {
                    "type": "string",
                    "description": "Status of task."
                },
                "id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of task."
                }
            }
        },
        "Overview": {
            "type": "object",
            "properties": {
                "ops": {
                    "type": "integer",
                    "format": "int64",
                    "description": "OPS of RebornDB."
                },
                "product": {
                    "type": "string",
                    "description": "Name of product."
                },
                "redis_infos": {
                    "type": "array",
                    "description": "Information of stores.",
                    "items": {
                        "$ref": "#/definitions/RedisInfo"
                    }
                }
            }
        },
        "ProxyInfo": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "string",
                    "description": "ID of proxy."
                },
                "addr": {
                    "type": "string",
                    "description": "Addr of proxy."
                },
                "last_event": {
                    "type": "string",
                    "description": "Last event."
                },
                "last_event_ts": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Last event timestamp."
                },
                "state": {
                    "type": "string",
                    "description": "Status of proxy."
                },
                "description": {
                    "type": "string",
                    "description": "Description of proxy."
                },
                "debug_var_addr": {
                    "type": "string",
                    "description": "Debug addr of proxy."
                },
                "pid": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Pid of proxy."
                },
                "start_at": {
                    "type": "string",
                    "description": "Start time of proxy."
                }
            }
        },
        "RangeSetTask": {
            "type": "object",
            "properties": {
                "from": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of migarate from slot."
                },
                "to": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of migarate to slot."
                },
                "new_group": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of new group."
                },
                "status": {
                    "type": "string",
                    "description": "Status of task."
                }
            }
        },
        "RebalanceStatus": {
            "type": "object",
            "properties": {
                "is_rebalancing": {
                    "type": "boolean",
                    "description": "Whether is in rebalancing."
                }
            }
        },
        "RedisInfo": {
            "type": "object",
            "properties": {}
        },
        "Result": {
            "type": "object",
            "properties": {
                "ret": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Response return value."
                },
                "msg": {
                    "type": "string",
                    "description": "Response message."
                }
            }
        },
        "Server": {
            "type": "object",
            "properties": {
                "type": {
                    "type": "string",
                    "description": "Type of server[master/slave]."
                },
                "group_id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of server group."
                },
                "addr": {
                    "type": "string",
                    "description": "Addr of server."
                }
            }
        },
        "ServerGroup": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of server group."
                },
                "product_name": {
                    "type": "string",
                    "description": "Name of product."
                },
                "servers": {
                    "type": "array",
                    "description": "Servers of server group.",
                    "items": {
                        "$ref": "#/definitions/Server"
                    }
                }
            }
        },
        "Slot": {
            "type": "object",
            "properties": {
                "id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of slot."
                },
                "product_name": {
                    "type": "string",
                    "description": "Name of product."
                },
                "group_id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of server group."
                },
                "state": {
                    "type": "object",
                    "description": "Servers of server group.",
                    "$ref": "#/definitions/SlotState"
                }
            }
        },
        "SlotMigrateStatus": {
            "type": "object",
            "properties": {
                "from": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of migarate from slot."
                },
                "to": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of migarate to slot."
                }
            }
        },
        "SlotState": {
            "type": "object",
            "properties": {
                "status": {
                    "type": "string",
                    "description": "Status of slot."
                },
                "migrate_status": {
                    "type": "object",
                    "description": "Migrate status of slot.",
                    "$ref": "#/definitions/SlotMigrateStatus"
                },
                "last_op_ts": {
                    "type": "string",
                    "description": "Last operation timestamp."
                }
            }
        },
        "SlotKeysInfo": {
            "type": "object",
            "properties": {
                "key": {
                    "type": "integer",
                    "format": "int64",
                    "description": "Keys count in slot."
                },
                "slot_id": {
                    "type": "integer",
                    "format": "int64",
                    "description": "ID of slot."
                }
            }
        }
    }
}